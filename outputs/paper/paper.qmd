---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(haven)
library(usethis)
library(here)
library(knitr)
library(palmerpenguins)
```

# Introduction

You can and should cross-reference sections and sub-sections.

The remainder of this paper is structured as follows. @sec-data....

# Data {#sec-data}

The raw data was achieved from a paper "https://www.aeaweb.org/articles?id=10.1257/pandp.20201118". All improper variables were removed during the data-cleaning process for accurate results. The statistics of all police officers have been separated into each race/gender group to analyze factors of the award nomination. 

```{r}
#| label: Table 1
#| fig-cap: Table
#| echo: false
month_data <- read_dta(here("inputs/data/officer_month_data.dta"))
year_data <- read_dta(here("inputs/data/officer_year_data.dta"))

number_of_officer <- month_data |>
  group_by(nuid) |>
  summarise()

#all data of every officer
all_officer <- month_data |>
  group_by(nuid) |>
  summarise(total_month = max(unit_duration), birth = max(birth_year), arrest = sum(arrest_total), Complaints = sum(cmpl_civ), Gender = max(female), White = max(white), Black = max(black), awd_perf = sum(awd_perf))

#all data of every officer from year data
all_officer_year <- year_data |>
  group_by(nuid) |>
  summarise(birth = max(birth_year), arrest = sum(arrest_total), Complaints = sum(cmpl_civ), Female = max(female), White = max(white), Black = max(black), Asian = max(asian), Hisp = max(hisp), Natam = max(natam), awd_perf = sum(awd_perf))

#all data of every white officer
white_officer <- month_data |>
  group_by(nuid) |>
  filter(white == 1) |>
  summarise(total_month = max(unit_duration), birth = max(birth_year), arrest = sum(arrest_total), Complaints = sum(cmpl_civ), Gender = max(female), White = max(white), Black = max(black))

#all data of every black officer
black_officer <- month_data |>
  group_by(nuid) |>
  filter(black == 1) |>
  summarise(total_month = max(unit_duration), birth = max(birth_year), arrest = sum(arrest_total), Complaints = sum(cmpl_civ), Gender = max(female), White = max(white), Black = max(black))

#all data of every male officer
male_officer <- month_data |>
  group_by(nuid) |>
  filter(female == 0) |>
  summarise(total_month = max(unit_duration), birth = max(birth_year), arrest = sum(arrest_total), Complaints = sum(cmpl_civ), Gender = max(female), White = max(white), Black = max(black))

#all data of every female officer
female_officer <- month_data |>
  group_by(nuid) |>
  filter(female == 1) |>
  summarise(total_month = max(unit_duration), birth = max(birth_year), arrest = sum(arrest_total), Complaints = sum(cmpl_civ), Gender = max(female), White = max(white), Black = max(black))

#reproduce Table 1
avg_brith_of_officer <- month_data |>
  group_by(nuid) |>
  summarise(birth = mean(birth_year))

avg_start_of_officer <- month_data |>
  group_by(nuid) |>
  summarise(birth = mean(start_month))

#make a dataframe for baseline table
#average birth year of each race/gender group
all_birth_year <- c(mean(all_officer$birth), 
                    mean(white_officer$birth), mean(black_officer$birth),
                    mean(male_officer$birth), mean(female_officer$birth))

#average training duration of each race/gender group
all_training <- c(mean(all_officer$total_month), 
                    mean(white_officer$total_month), mean(black_officer$total_month),
                    mean(male_officer$total_month), mean(female_officer$total_month))

#average number of complaints of each race/gender group
all_complain <- c(mean(all_officer$Complaints), 
                    mean(white_officer$Complaints), mean(black_officer$Complaints),
                    mean(male_officer$Complaints), mean(female_officer$Complaints))

#average number of arrests of each race/gender group
all_arrest <- c(mean(all_officer$arrest), 
                    mean(white_officer$arrest), mean(black_officer$arrest),
                    mean(male_officer$arrest), mean(female_officer$arrest))

#number of observations of each race/ gender group
all_observation <- c(nrow(all_officer), 
                     nrow(white_officer), nrow(black_officer), 
                     nrow(male_officer), nrow(female_officer))

Groups <- c("Everyone", "White", "Black", "Male", "Female")

baseline_characteristics <- data.frame(Groups
                                       , all_birth_year, all_training,
                                       all_complain, all_arrest, 
                                       all_observation)

kable(baseline_characteristics)
```

According to the TABLE 1 [Table 1â€” Baseline Characteristics ] ...

```{r}
#| label: Table 2
#| fig-cap: Bills of penguins
#| echo: false


```


```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false


```

Talk way more about it.

# Model



## Model set-up
Original Model
```{=tex}
\begin{align}
y_{it} &= \beta_0 + \beta_1 Black_i + \beta_2 Female_i + \beta_3 Hispanic_i \\
&+ \beta_4 Asian_i + \beta_5 NatAm_i + X_{it} + u_{it}
\end{align}
```

```{r}
#| echo: false
org_model <- lm(awd_perf ~ Black + Female + Hisp + Asian + Natam, data = all_officer_year)
org_model
```


Model 1
```{=tex}
\begin{align}
y &= \beta_0 + \beta_1 Black_i + \beta_2 Female_i + \beta_3 Hispanic_i \\
&+ \beta_4 Asian_i + \epsilon
\end{align}
```

```{r}
#| echo: false
modified_model <- lm(awd_perf ~ Black + Female + Hisp + Asian, data = all_officer_year)
modified_model
```


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.

# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("outputs/models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false


```

# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this.

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check


```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

```

\newpage

# References
